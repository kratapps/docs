{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-\\.,!=\\[\\]()\"`/]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Docs","text":""},{"location":"#test-data-factory","title":"Test Data Factory","text":"<p>Create sObjects in unit tests seamlessly.</p> <ul> <li>Test Data Factory out-of-the-box creates records with all required fields     already populated.</li> <li>Extend <code>SObjectFactory</code> class or add Custom Metadata to provide base records     for your unit tests. This way you can ensure records pass validation rules.</li> <li>Do you need in some unit tests more customized records? Define your records     using the <code>SObjectFactoryScenario</code>.</li> <li>Custom Settings and sObjects from managed packages can also be created.</li> </ul>"},{"location":"#example","title":"Example","text":"<pre><code>// create account, required fields are populated automatically\n// add fields specific for your unit test\nAccount acc = (Account) factory\n    .inserted(new Account(\n        Description = 'My Account',\n        Parent = anotherAcc\n    ))\n    .toSObject();\n// create 5 contacts with 3 different descriptions\nList&lt;Contact&gt; created = (List&lt;Contact&gt;) factory\n    .rotate(Contact.Description, new List&lt;String&gt;{'desc 0', 'desc 1', 'desc 2'})\n    .inserted(5, new Contact())\n    .toList();\n</code></pre>"},{"location":"#installation","title":"Installation","text":"<p>You can either install our free Managed Package or deploy code unpackaged. Do not modify the unpackaged code, we are not able to provide support if code deployed unpackaged.</p> <p>Version ID: 04t09000000vCWn</p>"},{"location":"#managed-package","title":"Managed Package","text":"<p>Install Managed Package using this URL:</p> <pre><code>https://login.salesforce.com/packaging/installPackage.apexp?p0=04t09000000vCWn\n</code></pre> <p>or using sfdx cli:</p> <pre><code>sf package install -p 04t09000000vCWn -o my-org\n</code></pre>"},{"location":"#unpackaged","title":"Unpackaged","text":"<p>Use our sfdx plugin to install all components in the <code>src/main/core/</code> without cloning:</p> <pre><code>sf kratapps remote deploy start \\\n    --repo-owner kratapps \\\n    --repo-name test-data-factory \\\n    --source-dir src/main/core/ \\\n    -o my-org\n</code></pre> <p>or clone the project and deploy using standard sfdx command:</p> <pre><code>git clone https://github.com/kratapps/test-data-factory.git\ncd test-data-factory\nsf project deploy start --source-dir src/main/core/ -o my-org\n</code></pre>"},{"location":"#usage","title":"Usage","text":"<p>You can create records using the TDF immediately in small projects or sObjects that are created only occasionally in unit tests. For other cases, we recommend extending <code>SObjectFactory</code> and/or <code>SObjectFactoryScenario</code> for each sObject type. <code>SObjectFactory/SObjectFactoryScenario</code> gives you more flexibility.</p>"},{"location":"#test-data-factory_1","title":"Test Data Factory","text":"<p>Initialize TDF in your unit test class.</p> <pre><code>private static final sobj.TestDataFactory factory = new sobj.TestDataFactory();\n</code></pre>"},{"location":"#operations","title":"Operations","text":"<p>Choose one of these operations: create, mock and insert. Prefer crete or mock over insert to improve performance.</p> create mock insert Performance fast fast slower With Ids \u2715 \u2713 \u2713 Queryable \u2715 \u2715 \u2713 Custom Settings \u2713 \u2713 \u2713 Custom Metadata \u2713 \u2713 \u2715 <p>Required fields are populated automatically. Default fields can be overridden using the target sObject provided. The TDF will insert this account.</p> <pre><code>Account acc = (Account) factory.inserted(new Account(\n        Description = 'Overridden Description'\n)).toSObject();\n</code></pre> <p>This record will have the AccountId of the account created above. Just assign the account and the Id will be populated automatically from the account sObject. In case you created the <code>AccountFactory</code> class, the account won't be created in that class this case. Create operation will not insert the record.</p> <pre><code>Contact con = (Contact) factory.created(new Contact(\n        Account = acc\n)).toSObject();\n</code></pre> <p>The mock operation will not insert the record. This record has generated Id, but the record does not exist in the database.</p> <pre><code>Contact con2 = (Contact) factory.mocked(new Contact()).toSObject();\n</code></pre> <p>Generate multiple records.</p> <pre><code>List&lt;Contact&gt; contacts = (List&lt;Contact&gt;) factory.inserted(200, new Contact()).toList();\n</code></pre> <p>Get mocked/inserted record by Id using getRecord static method</p> <pre><code>SObject sObj = sobj.TestDataFactory.getRecord(sObjectId);\n</code></pre>"},{"location":"#default-values","title":"Default Values","text":"<p>There are multiple ways how to set field values:</p> <ul> <li>Fields in the <code>target</code> sObject. This is the sObject you pass to     created/inserted/mocked methods.</li> <li>Fields in the <code>defaults</code> sObject. This is the sObject returned by     <code>createDefaults</code> method.</li> <li>Fields in the <code>metadata defaults</code> sObject. This sObject is build from     Test_Data_Factory_Default__mdt metadata.</li> </ul> <p>If you define a value for a same field more than once, the order is as follows: <code>target</code> &gt; <code>defaults</code> &gt; <code>metadata defaults</code>.</p>"},{"location":"#metadata-defaults","title":"Metadata Defaults","text":"<p>Define default fields values using Test_Data_Factory_Default__mdt custom metadata. This way, you can set fields values without creating or modifying any Apex code. Set sObject API name, field API name, and value in each entry. Optionally, you can enable each default value to a subset of:</p> <ul> <li>Custom Factory. Taken into account only if SObjectFactory for related     SObject is implemented and a scenario is not used.</li> <li>Default Factory. Taken into account only if SObjectFactory for related     SObject is not implemented and a scenario is not used.</li> <li>Scenario. Taken into account only if a scenario is used.</li> </ul>"},{"location":"#sobject-factories-and-scenarios","title":"SObject Factories and Scenarios","text":"<p>SObject Factories and Scenarios provide the same interface. Look at the table below to choose between SObject Factory and Scenario.</p> Factory Scenario When to use to create records with attributes for most unit tests to create special case records Extends sobj.SObjectFactory sobj.SObjectFactoryScenario Class Name SObject Api Name without '_', '__c', '__mdt' followed by 'Factory' anything Count only one per SObject multiple per SObject How to use don't use useScenario use useScenario"},{"location":"#sobject-factory","title":"SObject Factory","text":"<p>Make sure to</p> <ul> <li>name the class after the SObject (without __c and underscores) with     <code>Factory</code> suffix</li> <li>make the class and its methods global</li> <li>annotate the class with <code>@IsTest</code></li> </ul>"},{"location":"#methods","title":"Methods","text":"<ul> <li> <p>createDefaults     This method creates a new record with default values. Avoid any DML     Operation here as it is called for every sObject created.</p> </li> <li> <p>makeParent (optional)     This method is called only once for each relationship.     The parent should be created in this method, because the method is not     called for records that already have the parent. This way you can reduce     redundant DML statements.</p> </li> <li> <p>getDmlOptions (optional)     Every factory comes with DML Options, default DML Options have     <code>duplicateRuleHeader.allowSave</code> set to true.     You can override this behavior.</p> </li> <li> <p>requireRecordType (optional)     If sObject has record types, it is enforced to set the RecordTypeId in unit     tests.     You can disable this feature by overriding this method.</p> </li> <li> <p>autoPopulateRequiredFields (optional)     This feature is enabled for every sObject without SObject Factory class.     Once you create the SObject Factory instance class, the feature is disabled     by default. Override this method and return true to enable it again. We     strongly recommend disabling this feature for sObjects with a lot of fields     to improve performance.</p> </li> </ul>"},{"location":"#example-implementation","title":"Example Implementation","text":"<pre><code>@IsTest\nglobal without sharing class ContactFactory extends sobj.SObjectFactory {\n    private final sobj.ITestDataFactory factory = new sobj.TestDataFactory();\n\n    public SObject createDefaults(SObject target) {\n        return new Contact(\n                FirstName = 'First',\n                LastName = 'Last'\n        );\n    }\n    public override SObject makeParent(SObjectField sObjField, SObject target) {\n        if (sObjField == Contact.AccountId) {\n            return factory.inserted(new Account()).toSObject();\n        } else if (sObjField == ...) {\n            return ...\n        }\n        return null;\n    }\n}\n</code></pre>"},{"location":"#sobject-factory-scenario","title":"SObject Factory Scenario","text":"<p>Sometimes you need special factories for special use cases.</p> <p>For example, your open opportunity is quite different from the closed one. The closed one requires multiple related objects which are not required for the open one. <code>OpportunityFactory</code> class will provide open opportunities. Then create <code>ClosedOpportunityFactory</code> that will provide closed opportunities. The <code>ClosedOpportunityFactory</code> will extend the <code>SObjectFactoryScenario</code> class. To use the <code>ClosedOpportunityFactory</code> call the <code>useScenario</code> method.</p> <pre><code>// this will use the OpportunityFactory\nOpportunity opp = (Opportunity) factory.inserted(new Opportunity()).toSObject();\n// this will use the ClosedOpportunityFactory\nOpportunity closedOpp = (Opportunity) factory\n    .useScenario(ClosedOpportunityFactory.class)\n    .inserted(new Opportunity())\n    .toSObject();\n</code></pre>"},{"location":"#rotations","title":"Rotations","text":"<p>If you want your records to have different values, you can use <code>rotate</code> method. In the following example you we will create 5 contacts with 3 different descriptions:</p> <pre><code>List&lt;Contact&gt; created = (List&lt;Contact&gt;) factory\n    .rotate(Contact.Description, new List&lt;String&gt;{'desc 0', 'desc 1', 'desc 2'})\n    .rotate(Contact.AccountId, accountList)\n    .created(5, new Contact())\n    .toList();\n</code></pre> <p>If using rotation for a relationship field, use Id field and list of sObjects. In our example <code>.rotate(Contact.AccountId, accountList)</code>.</p>"},{"location":"#best-practices","title":"Best Practices","text":"<p>Common best practices while using this TDF.</p>"},{"location":"#insertable-records","title":"Insertable records","text":"<p>You should be able to insert every record without providing any values in the call. The following snippet should work in every unit test for all sObjects:</p> <pre><code>Contact con = (Contact) factory.inserted(new Contact()).toSObject();\n</code></pre> <p>For example User requires ProfileId which is not possible to insert automatically. In case you want to create user objects in your unit tests you should create <code>UserFactory</code> class and assign ProfileId there. The ProfileId can be then overridden in the created/mocked/inserted method call in a unit test.</p>"},{"location":"#disable-auto-populate-required-fields","title":"Disable auto populate required fields","text":"<p>When your sObject has hundreds of fields, you should disable auto populating to improve performance. Set <code>autoPopulateRequiredFields</code> false in your SObject Factory class.</p>"},{"location":"release-notes/1.4/","title":"1.4","text":"<p>Version ID: 04t09000000vCWn</p> <ul> <li>Fix issue #3 -     Values defaulted on created are ignored.</li> <li>Change the default value for all standard Quantity fields from 0 to 1.</li> <li>Enhance the default SObject factory to support more standard objects out of     the box.</li> <li>Add unit tests to cover more standard objects.</li> <li>Add a unit test to test managed package records.</li> </ul>"}]}